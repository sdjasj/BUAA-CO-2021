# 计数器使用说明

### 1. 模式0

#### 1.1 状态：IDLE

| 可行操作                  | 对应功能                                                     |
| ------------------------- | ------------------------------------------------------------ |
| 写CTRL[0]为1或0           | 写CTRL[0]为1则允许计数器计数，待进入LOAD状态。为0则不允许计数，保持IDLE状态 |
| 写preset寄存器            | 更新计数初值                                                 |
| 写CTRL[2:1] 为0或1        | 为下次计数更换模式                                           |
| 写CTRL[3]                 | 是否屏蔽中断                                                 |
| 读CTRL preset count寄存器 | 读数                                                         |

| 不可行操作         | 误操作后果               |
| ------------------ | ------------------------ |
| 写CTRL[31:4]       | 写的数会被忽略           |
| 写count            | 引发ADES异常             |
| 写CTRL[2:1] 为2或3 | 未定义行为，按模式一处理 |

#### 1.2 状态：LOAD

| 可行操作                  | 对应功能                |
| ------------------------- | ----------------------- |
| 写preset寄存器            | 更新计数初值            |
| 写CTRL[2:1]为0或1         | 为计数更换模式          |
| 写CTRL[3]                 | 是否屏蔽中断            |
| 写CTRL[0] 为0             | 在CNT状态会回到IDLE状态 |
| 读CTRL preset count寄存器 | 读数                    |

| 不可行操作         | 误操作后果               |
| ------------------ | ------------------------ |
| 写CTRL[31:4]       | 写的数会被忽略           |
| 写count            | 引发ADES异常             |
| 写CTRL[2:1] 为2或3 | 未定义行为，按模式一处理 |

#### 1.3 状态 CNT

| 可行操作                  | 对应功能                |
| ------------------------- | ----------------------- |
| 写preset寄存器            | 更新计数初值            |
| 写CTRL[0] 为0             | 在CNT状态会回到IDLE状态 |
| 写CTRL[2:1]为0或1         | 为计数更换模式          |
| 写CTRL[3]                 | 是否屏蔽中断            |
| 读CTRL preset count寄存器 | 读数                    |

| 不可行操作         | 误操作后果               |
| ------------------ | ------------------------ |
| 写CTRL[31:4]       | 写的数会被忽略           |
| 写count            | 引发ADES异常             |
| 写CTRL[2:1] 为2或3 | 未定义行为，按模式一处理 |

#### 1.4 状态 INT

| 可行操作                  | 对应功能       |
| ------------------------- | -------------- |
| 写preset寄存器            | 更新计数初值   |
| 写CTRL[2:1]为0或1         | 为计数更换模式 |
| 写CTRL[3]                 | 是否屏蔽中断   |
| 读CTRL preset count寄存器 | 读数           |

| 不可行操作         | 误操作后果                 |
| ------------------ | -------------------------- |
| 写CTRL[31:4]       | 写的数会被忽略             |
| 写count            | 引发ADES异常               |
| 写CTRL[2:1] 为2或3 | 未定义行为，按模式一处理   |
| 写CTRL[0] 为0或1   | 无意义，在INT状态自动变为0 |

### 2. 模式1

#### 2.1 状态：IDLE

| 可行操作                  | 对应功能                                                     |
| ------------------------- | ------------------------------------------------------------ |
| 写CTRL[0]为1或0           | 写CTRL[0]为1则允许计数器计数，待进入LOAD状态。为0则不允许计数，保持IDLE状态 |
| 写preset寄存器            | 更新计数初值                                                 |
| 写CTRL[2:1] 为0或1        | 为下次计数更换模式                                           |
| 写CTRL[3]                 | 是否屏蔽中断                                                 |
| 读CTRL preset count寄存器 | 读数                                                         |

| 不可行操作         | 误操作后果               |
| ------------------ | ------------------------ |
| 写CTRL[31:4]       | 写的数会被忽略           |
| 写count            | 引发ADES异常             |
| 写CTRL[2:1] 为2或3 | 未定义行为，按模式一处理 |

#### 2.2 状态：LOAD

| 可行操作                  | 对应功能                |
| ------------------------- | ----------------------- |
| 写CTRL[0] 为0             | 在CNT状态会回到IDLE状态 |
| 写preset寄存器            | 更新计数初值            |
| 写CTRL[2:1]为0或1         | 为计数更换模式          |
| 写CTRL[3]                 | 是否屏蔽中断            |
| 读CTRL preset count寄存器 | 读数                    |

| 不可行操作         | 误操作后果               |
| ------------------ | ------------------------ |
| 写CTRL[31:4]       | 写的数会被忽略           |
| 写count            | 引发ADES异常             |
| 写CTRL[2:1] 为2或3 | 未定义行为，按模式一处理 |

#### 2.3 状态 CNT

| 可行操作                  | 对应功能                |
| ------------------------- | ----------------------- |
| 写CTRL[0] 为0             | 在CNT状态会回到IDLE状态 |
| 写preset寄存器            | 更新计数初值            |
| 写CTRL[2:1]为0或1         | 为计数更换模式          |
| 写CTRL[3]                 | 是否屏蔽中断            |
| 读CTRL preset count寄存器 | 读数                    |

| 不可行操作         | 误操作后果                 |
| ------------------ | -------------------------- |
| 写CTRL[31:4]       | 写的数会被忽略             |
| 写count            | 引发ADES异常               |
| 写CTRL[2:1] 为2或3 | 未定义行为，按模式一处理   |
| 写CTRL[0] 为0或1   | 无意义，在INT状态自动变为0 |

#### 2.4 状态 INT

| 可行操作                  | 对应功能                                          |
| ------------------------- | ------------------------------------------------- |
| 写CTRL[0]为1或0           | 写CTRL[0]为1则允许下次计数器计数。为0则不允许计数 |
| 写preset寄存器            | 更新计数初值                                      |
| 写CTRL[2:1]为0或1         | 为计数更换模式                                    |
| 写CTRL[3]                 | 是否屏蔽中断                                      |
| 读CTRL preset count寄存器 | 读数                                              |

| 不可行操作         | 误操作后果               |
| ------------------ | ------------------------ |
| 写CTRL[31:4]       | 写的数会被忽略           |
| 写count            | 引发ADES异常             |
| 写CTRL[2:1] 为2或3 | 未定义行为，按模式一处理 |



## 计时器状态转移图

### 模式0

<img src="D:\计算机\计组实验\P7\设计文档\TIME0.png" alt="TIME0" style="zoom:150%;" />

### 模式1

<img src="D:\计算机\计组实验\P7\设计文档\TIME1.png" alt="TIME1" style="zoom:150%;" />

